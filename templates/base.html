{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- SEO Meta Tags -->
    <title>{% block title %}{{ site_config.site_name|default:"ASBJJ - Alexandre Salgado Brazilian Jiu-Jitsu" }}{% endblock %}</title>
    <meta name="description" content="{% block description %}{{ site_config.meta_description|default:"Academia de Jiu-Jitsu, Defesa Pessoal e Yoga em São Paulo. Professores Alexandre Salgado e Ana Carolina." }}{% endblock %}">
    <meta name="keywords" content="{% block keywords %}{{ site_config.meta_keywords|default:"jiu-jitsu, defesa pessoal, yoga, academia, São Paulo, Alexandre Salgado" }}{% endblock %}">
    <meta name="author" content="ASBJJ">
    <meta name="robots" content="{% block robots %}index, follow{% endblock %}">
    <meta name="language" content="pt-BR">
    <meta name="revisit-after" content="7 days">
    <meta name="rating" content="general">
    <meta name="distribution" content="global">
    <meta name="geo.region" content="BR-SP">
    <meta name="geo.placename" content="São Paulo">
    <meta name="geo.position" content="-23.5505;-46.6333">
    <meta name="ICBM" content="-23.5505, -46.6333">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical %}{{ request.build_absolute_uri }}{% endblock %}">
    
    <!-- Alternate languages -->
    <link rel="alternate" hreflang="pt-BR" href="{{ request.build_absolute_uri }}">
    
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}{{ site_config.site_name|default:"ASBJJ" }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ site_config.site_description|default:"Academia de Jiu-Jitsu, Defesa Pessoal e Yoga" }}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% if site_config.site_logo and site_config.site_logo.url %}{{ site_config.site_logo.url }}{% else %}/static/img/logo.png{% endif %}{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:site_name" content="ASBJJ">
    <meta property="og:locale" content="pt_BR">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="{% block og_image_alt %}ASBJJ - Academia de Jiu-Jitsu{% endblock %}">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{{ site_config.site_name|default:"ASBJJ" }}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{{ site_config.site_description|default:"Academia de Jiu-Jitsu, Defesa Pessoal e Yoga" }}{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{% if site_config.site_logo and site_config.site_logo.url %}{{ site_config.site_logo.url }}{% else %}/static/img/logo.png{% endif %}{% endblock %}">
    <meta name="twitter:site" content="@asbjj">
    <meta name="twitter:creator" content="@asbjj">
    <meta name="twitter:image:alt" content="{% block twitter_image_alt %}ASBJJ - Academia de Jiu-Jitsu{% endblock %}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% if site_config.site_favicon %}{{ site_config.site_favicon.url }}{% else %}{% static 'img/logo.png' %}{% endif %}">
    <link rel="apple-touch-icon" href="{% if site_config.site_logo and site_config.site_logo.url %}{{ site_config.site_logo.url }}{% else %}{% static 'img/logo.png' %}{% endif %}">
    <link rel="manifest" href="/static/manifest.webmanifest">
    
    <!-- Schema.org structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{% block schema_type %}Organization{% endblock %}",
        "name": "ASBJJ - Alexandre Salgado Brazilian Jiu-Jitsu",
        "description": "Academia de Jiu-Jitsu, Defesa Pessoal e Yoga em São Paulo",
        "url": "{{ request.build_absolute_uri }}",
        "logo": "{% if site_config.site_logo and site_config.site_logo.url %}{{ site_config.site_logo.url }}{% else %}/static/img/logo.png{% endif %}",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "São Paulo",
            "addressRegion": "SP",
            "addressCountry": "BR"
        },
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "{% if site_config.contact_phone %}{{ site_config.contact_phone }}{% else %}+55-11-99999-9999{% endif %}",
            "contactType": "customer service",
            "availableLanguage": "Portuguese"
        },
        "sameAs": [
            "https://www.instagram.com/asbjj",
            "https://www.facebook.com/asbjj"
        ]
    }
    </script>
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
    <!-- Mobile optimizations -->
    <style>
        /* Smooth scrolling for all devices */
        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        
        /* Better tap highlight */
        * {
            -webkit-tap-highlight-color: rgba(44, 62, 80, 0.1);
        }
        
        /* Touch-friendly buttons */
        @media (max-width: 768px) {
            .btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Larger tap targets */
            .nav-link {
                padding: 12px 16px;
                min-height: 44px;
                display: flex;
                align-items: center;
            }
            
            /* Better spacing for mobile */
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            
            /* Prevent zoom on input focus (iOS fix) */
            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="password"],
            input[type="number"],
            input[type="search"],
            textarea,
            select {
                font-size: 16px !important;
            }
            
            /* Better mobile navigation */
            .navbar-toggler {
                border: 2px solid rgba(255, 255, 255, 0.7) !important;
                padding: 8px 12px;
                min-height: 44px;
                min-width: 44px;
                background: rgba(255, 255, 255, 0.1);
            }
            
            .navbar-toggler:focus {
                box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.25) !important;
            }
            
            .navbar-toggler-icon {
                width: 24px;
                height: 24px;
            }
            
            .navbar-collapse {
                background: rgba(44, 62, 80, 0.98) !important;
                backdrop-filter: blur(10px);
                border-radius: 0 0 8px 8px;
                margin-top: 0;
                padding: 16px;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            }
            
            .navbar-collapse.show,
            .navbar-collapse.collapsing {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                z-index: 1000;
            }
            
            /* Mobile cards spacing */
            .card {
                margin-bottom: 1.5rem;
            }
            
            /* Mobile images */
            img {
                max-width: 100%;
                height: auto;
            }
        }
        
        /* Extra small devices */
        @media (max-width: 576px) {
            body {
                font-size: 0.95rem;
            }
            
            h1 {
                font-size: 1.75rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.25rem;
            }
            
            .container {
                padding-left: 12px;
                padding-right: 12px;
            }
        }
        
        /* PWA optimizations */
        @media (display-mode: standalone) {
            .navbar {
                padding-top: env(safe-area-inset-top);
            }
            
            footer {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        /* Landscape orientation */
        @media (max-height: 600px) and (orientation: landscape) {
            .navbar {
                padding: 0.5rem 0;
            }
            
            .navbar-brand img {
                height: 40px !important;
            }
        }
        
        /* Prevent text inflation on some mobile browsers */
        body {
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* Optimize scrolling performance */
        * {
            -webkit-overflow-scrolling: touch;
        }
    </style>
    
    <!-- Google Analytics -->
    {% if site_config.google_analytics_id %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site_config.google_analytics_id }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site_config.google_analytics_id }}', {
            'anonymize_ip': true,
            'cookie_flags': 'SameSite=Strict;Secure',
            'send_page_view': true
        });
        
        // Enhanced e-commerce tracking
        gtag('config', '{{ site_config.google_analytics_id }}', {
            'custom_map': {
                'custom_parameter_1': 'user_type',
                'custom_parameter_2': 'page_category'
            }
        });
    </script>
    {% endif %}
    
    <!-- Performance monitoring -->
    <script>
        // Core Web Vitals monitoring
        function sendToAnalytics(metric) {
            if (typeof gtag !== 'undefined') {
                gtag('event', metric.name, {
                    event_category: 'Web Vitals',
                    event_label: metric.id,
                    value: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
                    non_interaction: true,
                });
            }
        }
        
        // Monitor page load performance
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                if (perfData) {
                    const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'page_load_time', {
                            event_category: 'Performance',
                            value: Math.round(loadTime),
                            non_interaction: true,
                        });
                    }
                }
            }
        });
        
        // Error tracking
        window.addEventListener('error', function(e) {
            if (typeof gtag !== 'undefined') {
                gtag('event', 'javascript_error', {
                    event_category: 'Error',
                    event_label: e.message,
                    value: 1,
                    non_interaction: true,
                });
            }
        });
    </script>
    
    {% block extra_css %}{% endblock %}
</head>

<body class="d-flex flex-column min-vh-100">
    <!-- Skip to main content (Acessibilidade) -->
    <a href="#main-content" class="visually-hidden-focusable btn btn-primary position-absolute top-0 start-0 m-3">
        Pular para o conteúdo principal
    </a>

    <!-- Header -->
    <header class="bg-dark shadow-sm">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container position-relative">
                <!-- Logo -->
                <a class="navbar-brand d-flex align-items-center" href="{% url 'core:index' %}">
                    {% if site_config.site_logo and site_config.site_logo.url %}
                        <img src="{{ site_config.site_logo.url }}" alt="{{ site_config.site_name }}" height="60" class="me-2">
                    {% else %}
                        <img src="{% static 'img/logo.png' %}" alt="ASBJJ" height="60" class="me-2">
                    {% endif %}
                    <span class="fw-bold">{{ site_config.site_name|default:"ASBJJ" }}</span>
                </a>

                <!-- Mobile menu button -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Navigation menu -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'core:index' %}">
                                <i class="fas fa-home me-1"></i>Início
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'core:about' %}">
                                <i class="fas fa-info-circle me-1"></i>Sobre
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'core:services' %}">
                                <i class="fas fa-dumbbell me-1"></i>Serviços
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'core:shop' %}">
                                <i class="fas fa-store me-1"></i>Loja
                            </a>
                        </li>
                        <li class="nav-item">
                            {% if user.is_authenticated %}
                                <a class="nav-link" href="{% url 'students:student_dashboard' %}">
                                    <i class="fas fa-user-circle me-1"></i>Área do Aluno
                                </a>
                            {% else %}
                                <a class="nav-link" href="{% url 'students:login' %}">
                                    <i class="fas fa-sign-in-alt me-1"></i>Área do Aluno
                                </a>
                            {% endif %}
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'core:contact' %}">
                                <i class="fas fa-envelope me-1"></i>Contato
                            </a>
                        </li>
                    </ul>

                    <!-- User menu -->
                    <ul class="navbar-nav">
                        <!-- Favoritos -->
                        <li class="nav-item">
                            <a class="nav-link position-relative" href="{% url 'core:wishlist' %}">
                                <i class="fas fa-heart"></i>
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="wishlist-badge" style="display: none;">
                                    0
                                </span>
                            </a>
                        </li>
                        
                        <!-- Carrinho -->
                        <li class="nav-item">
                            <a class="nav-link position-relative" href="{% url 'core:cart' %}" title="Carrinho de Compras">
                                <i class="fas fa-shopping-cart"></i>
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cart-badge" style="display: none;">
                                    0
                                </span>
                                <small class="d-block text-muted" id="cart-total" style="font-size: 0.7rem; line-height: 1;">R$ 0,00</small>
                            </a>
                        </li>
                        
                        {% if user.is_authenticated %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-user me-1"></i>{{ user.get_full_name|default:user.username }}
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    {% if user.is_staff %}
                                    <li><a class="dropdown-item" href="/admin/">
                                        <i class="fas fa-user-edit me-2"></i>Admin
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    {% endif %}
                                    <li><a class="dropdown-item" href="/admin/logout/">
                                        <i class="fas fa-sign-out-alt me-2"></i>Sair
                                    </a></li>
                                </ul>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow-1">
        <!-- Messages -->
        {% if messages %}
            <div class="container mt-3">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light py-5 mt-5">
        <div class="container">
            <div class="row">
                <!-- Informações da Academia -->
                <div class="col-lg-4 mb-4">
                    <h5 class="fw-bold mb-3">
                        {% if site_config.site_logo and site_config.site_logo.url %}
                            <img src="{{ site_config.site_logo.url }}" alt="{{ site_config.site_name }}" height="40" class="me-2">
                        {% endif %}
                        {{ site_config.site_name|default:"ASBJJ" }}
                    </h5>
                    <p class="mb-3">{{ site_config.site_description|default:"Academia especializada em Jiu-Jitsu, Defesa Pessoal e Yoga." }}</p>
                    
                    <!-- Informações de Contato -->
                    <div class="contact-info">
                        {% if site_config.contact_phone %}
                            <p class="mb-2">
                                <i class="fas fa-phone me-2"></i>
                                <a href="tel:{{ site_config.contact_phone }}" class="text-light text-decoration-none">
                                    {{ site_config.contact_phone }}
                                </a>
                            </p>
                        {% endif %}
                        {% if site_config.contact_email %}
                            <p class="mb-2">
                                <i class="fas fa-envelope me-2"></i>
                                <a href="mailto:{{ site_config.contact_email }}" class="text-light text-decoration-none">
                                    {{ site_config.contact_email }}
                                </a>
                            </p>
                        {% endif %}
                        {% if site_config.contact_address %}
                            <p class="mb-2">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                {{ site_config.contact_address }}
                            </p>
                        {% endif %}
                        {% if site_config.contact_whatsapp %}
                            <p class="mb-2">
                                <i class="fab fa-whatsapp me-2"></i>
                                <a href="https://wa.me/{{ site_config.contact_whatsapp|slice:'1:' }}" class="text-light text-decoration-none">
                                    {{ site_config.contact_whatsapp }}
                                </a>
                            </p>
                        {% endif %}
                    </div>
                </div>

                <!-- Links Rápidos -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">Links Rápidos</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{% url 'core:index' %}" class="text-light text-decoration-none">Início</a></li>
                        <li class="mb-2"><a href="{% url 'core:about' %}" class="text-light text-decoration-none">Sobre</a></li>
                        <li class="mb-2"><a href="{% url 'core:services' %}" class="text-light text-decoration-none">Aulas</a></li>
                        <li class="mb-2"><a href="{% url 'core:contact' %}" class="text-light text-decoration-none">Contato</a></li>
                    </ul>
                </div>

                <!-- Modalidades -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="fw-bold mb-3">Modalidades</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="{% url 'core:services' %}?categoria=jiu-jitsu" class="text-light text-decoration-none">Jiu-Jitsu</a></li>
                        <li class="mb-2"><a href="{% url 'core:services' %}?categoria=defesa-pessoal" class="text-light text-decoration-none">Defesa Pessoal</a></li>
                        <li class="mb-2"><a href="{% url 'core:services' %}?categoria=yoga" class="text-light text-decoration-none">Yoga</a></li>
                    </ul>
                </div>

                <!-- Redes Sociais -->
                <div class="col-lg-4 mb-4">
                    <h6 class="fw-bold mb-3">Siga-nos</h6>
                    <div class="social-links mb-3">
                        {% if site_config.instagram_url %}
                            <a href="{{ site_config.instagram_url }}" class="btn btn-outline-light btn-sm me-2 mb-2" target="_blank" rel="noopener">
                                <i class="fab fa-instagram"></i> Instagram
                            </a>
                        {% endif %}
                        {% if site_config.facebook_url %}
                            <a href="{{ site_config.facebook_url }}" class="btn btn-outline-light btn-sm me-2 mb-2" target="_blank" rel="noopener">
                                <i class="fab fa-facebook"></i> Facebook
                            </a>
                        {% endif %}
                        {% if site_config.youtube_url %}
                            <a href="{{ site_config.youtube_url }}" class="btn btn-outline-light btn-sm me-2 mb-2" target="_blank" rel="noopener">
                                <i class="fab fa-youtube"></i> YouTube
                            </a>
                        {% endif %}
                        {% if site_config.tiktok_url %}
                            <a href="{{ site_config.tiktok_url }}" class="btn btn-outline-light btn-sm me-2 mb-2" target="_blank" rel="noopener">
                                <i class="fab fa-tiktok"></i> TikTok
                            </a>
                        {% endif %}
                    </div>

                    <!-- Newsletter -->
                    <div class="newsletter">
                        <h6 class="fw-bold mb-3">Newsletter</h6>
                        <form action="{% url 'core:contact' %}" method="post" class="d-flex">
                            {% csrf_token %}
                            <input type="email" name="email" class="form-control form-control-sm me-2" placeholder="Seu e-mail" required>
                            <button type="submit" class="btn btn-warning btn-sm">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Footer content without copyright -->
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">
                        {{ site_config.site_name|default:"ASBJJ" }} - Academia de Artes Marciais
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        Desenvolvido com <i class="fas fa-heart text-danger"></i> por 
                        <a href="https://fabianosf.github.io/fabianosf_/" target="_blank" rel="noopener" class="text-light text-decoration-none">
                            Fabiano Freitas
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Float Button -->
    {% if site_config.contact_whatsapp %}
        <a href="https://wa.me/{{ site_config.contact_whatsapp|slice:'1:' }}" 
           class="whatsapp-float btn btn-success rounded-circle position-fixed" 
           target="_blank" 
           rel="noopener"
           aria-label="Conversar no WhatsApp"
           style="bottom: 20px; right: 20px; width: 60px; height: 60px; z-index: 1000;">
            <i class="fab fa-whatsapp fa-2x"></i>
        </a>
    {% endif %}

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="{% static 'js/main.js' %}"></script>
    
    <!-- Script para garantir que o navbar funcione -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Garantir que o Bootstrap está carregado
            if (typeof bootstrap === 'undefined') {
                console.error('Bootstrap JS não carregou!');
            }
            
            // Forçar inicialização do collapse
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('#navbarNav');
            
            if (navbarToggler && navbarCollapse) {
                navbarToggler.addEventListener('click', function(e) {
                    e.preventDefault();
                    navbarCollapse.classList.toggle('show');
                });
                
                // Fechar menu ao clicar em um link
                const navLinks = navbarCollapse.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        navbarCollapse.classList.remove('show');
                    });
                });
                
                // Fechar menu ao clicar fora
                document.addEventListener('click', function(event) {
                    const isClickInside = navbarToggler.contains(event.target) || navbarCollapse.contains(event.target);
                    if (!isClickInside && navbarCollapse.classList.contains('show')) {
                        navbarCollapse.classList.remove('show');
                    }
                });
            }
        });
    </script>
    {% if site_config and site_config.tawkto_property_id %}
    <!-- Live chat (Tawk.to) -->
    <script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/{{ site_config.tawkto_property_id }}/default';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    {% endif %}
    {% if site_config.facebook_url %}
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v17.0" nonce="asbjj"></script>
    {% endif %}
    
    {% block extra_js %}{% endblock %}
    <script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/static/js/sw.js').catch(() => {});
    }
    
    // Carregar total do carrinho ao carregar a página
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/carrinho/total/', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const cartBadge = document.getElementById('cart-badge');
                const cartTotal = document.getElementById('cart-total');
                
                if (cartBadge && data.cart_total_items > 0) {
                    cartBadge.textContent = data.cart_total_items;
                    cartBadge.style.display = 'inline';
                }
                
                if (cartTotal) {
                    cartTotal.textContent = data.cart_total_price_formatted;
                }
            }
        })
        .catch(error => {
            // Erro ao carregar total do carrinho
        });
    });
    </script>
</body>
</html>
